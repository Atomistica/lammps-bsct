variable hvac index 15

units           real
boundary        p p f

atom_style      full
bond_style      harmonic
angle_style     charmm
dihedral_style  charmmfsw
improper_style  harmonic
special_bonds   charmm

pair_style      lj/charmmfsw/coul/long/bsct 8.0 12.0 7.0
pair_modify table 0

kspace_style pppm/bsct 1.0e-6
kspace_modify slab 3.0
#kspace_modify overlap no
#kspace_modify order 4
#kspace_modify disp/auto yes
#kspace_modify compute no

neighbor 1.0 bin
neigh_modify delay 0 every 1 check yes

read_data       electrodes.setup
region vac block $(xlo+0.1*(xhi-xlo)) $(xhi-0.1*(xhi-xlo)) $(ylo+0.1*(xhi-xlo)) $(yhi-0.1*(yhi-ylo)) $(zlo+0.1*(zhi-zlo)) $(zhi-0.1*(zhi-zlo))

include coeffs.setup

create_atoms 3 single $((xhi-xlo)/3) $((xhi-xlo)/3) $((zhi-zlo)/3.9)
create_atoms 4 single $((xhi-xlo)*2/3) $((yhi-ylo)*2/3) $((zhi-zlo)/4.1)
#create_atoms 3 random 1 122245 vac
#create_atoms 4 random 1 5422321 vac
set type 3 charge 1e-20
set type 4 charge -1e-20

change_box all z final $(zlo) $(2*zhi)
#^add vacuum above top electrode

timestep        1

group lower_plate type  1
group upper_plate type  2
group capacitor   union lower_plate    upper_plate
group anions      type  4
group cations     type  3
group ions        union anions         cations

#delete_atoms group ions

#fix           freeze capacitor setforce 0.0 0.0 0.0


# BSCT FIX SYNTAX
# fix groupID bsct atomType X U V p keyword values
# X: chemical potential; V: band structure contribution; U: Hubbard energy; p: exponent; Note that U cannot be "0"
fix             ct capacitor bsct nevery 1 qtot 0.0 log 0 mode 2 history 10 &
                beta 0.1 prec 0.005 max_iter 1000 &
                type 1 -.9 1 0.0001 1.0 &
                type 2 .9 1 0.0001 1.0 

fix_modify      ct energy yes

fix main ions nve

#fix             go     ions move linear 0.0 0.0 ${vel} units box
#fix           stay   substrate nve
#fix           freeze capacitor setforce 0.0 0.0 0.0
#fix main all nve
#fix bounce_back_top upper_plate wall/reflect zhi EDGE 
#fix bounce_back_bottom lower_plate wall/reflect zlo EDGE

thermo          100
thermo_style    custom step temp press etotal ke pe f_ct &  
                epair evdwl ecoul elong etail
thermo_modify   format float %15.14g norm no

dump            1 all custom 100 dump2.custom id mol type x y z q
#dump 1 all atom 100 dump2.custom
dump_modify     1 format line "%d %d %d %f %f %f %15.14e %15.14e"

run 500

log log.lammps append

write_data      final2.lammps
#write_dump      all image final2.png type type modify backcolor white
